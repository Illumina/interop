# Configuration for Travis CI Continuous Integration Service
#
# Build status: https://travis-ci.org/Illumina/interop
#
# Tested configurations:
#
#   Linux Clang 3.7
#     - Release/Debug
#   Linux GCC
#     - Release/Debug
#     - 4.6/4.9
#   OSX Clang
#     - Release/Debug
#
# No support for 32-bit Linux
#
# TODO: For Python wheels, support: https://github.com/pypa/manylinux
## TODO: Create individual builds for each language

language: cpp
sudo: required

env:
  global:
    secure: "WYChiEofbwDx6rZSLDuvrqPIC9Ny3BvjN1sfv2A186CtL3/+ay5N4n3dH9rdmK2dvM0NJ7Hf2YWJIuRs8DsCz3+bvo8Jhhx72gGf7QOjEE/KvyYbsiMX8P4nCQk8bm4xhLcYcYrTAaImeVRkpBjfO4w91vXrGLX1XxWigZB3yxo7uoxBcDIip9kmhmR4wVrciOs59vqQcLKbCA17Z9atdaoqhN9GyY5+h5+BCM1fG4Mv/yO93vHQ3yfVx3UabXIJjtA53XqoeTAFQGiRSIJ1Cd7gf5VkE8ZFORUepaSU+xv4R+Ih6UdsddX/7JZhzzztohYDzVTsfDc8Zs0qVV4Oemf7AUv+nz/B9yFbid/K7D/bN4q/FwUYqGVWt7bK+4R6Iih52QrI2a1I1UJSemYJfOo47r0mXKVPTGKphjkgVCp5OUQtmqmrms3G8B7kgDNMwpqBE7tKuDxN/G3wNibN8dsFYNjmRiZZuOdqqNfu7UmONn6jKMgA9946CZyZ2s2L5XwknlfkFtwwoQdRWIytk0f1szJruqiuotkg1AdPFn2MlfZxNk81u9cCZCvdwRTAbByjkrZPZcoA3vnxg8HFbHvukvHnQcdVWGrZYRoLTXpw2qi4J954Zx9uCODTnIucWTT1auG7y1OYwEkLcXAIEA2/WaBTiSeB3ADM7YspABc="

matrix:
  include:
  - os: osx
    compiler: clang
    env: DEPLOY_BUILD=true SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis OFF Release ALL"
  - os: linux
    compiler: clang
    env: SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis ON Debug Disable"
  - os: linux
    compiler: gcc
    env: SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis ON Debug Disable"
  - os: linux
    compiler: gcc
    sudo: required
    services:
      - docker
    env: DEPLOY_BUILD=true DEPLOY_DOCS=true DOCKER_IMAGE=ezralanglois/interop SCRIPT="docker run --rm -v $PWD:/io ezralanglois/interop sh /io/tools/package.sh /io /io/dist travis OFF Release None"
  - os: osx
    compiler: clang
    env: SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis OFF Debug Disable"
  - os: linux
    compiler: gcc
    addons: &1
      apt:
        sources:
        - george-edison55-precise-backports
        - ubuntu-toolchain-r-test
        - sourceline: 'ppa:teward/swig3.0'
        packages:
        - g++-5
        - libicu-dev
        - swig3.0
        - doxygen
        - graphviz
        - mono-complete
        - libgtest-dev
        - python-numpy
    env: COMPILER_VERSION=-5 SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis ON Debug Disable"
  - os: linux
    compiler: clang
    addons: &2
      apt:
        sources:
        - george-edison55-precise-backports
        - ubuntu-toolchain-r-test
        - llvm-toolchain-precise-3.7
        - sourceline: 'ppa:teward/swig3.0'
        packages:
        - g++-4.9
        - clang-3.7
        - libicu-dev
        - swig3.0
        - doxygen
        - graphviz
        - mono-complete
        - libgtest-dev
        - python-numpy
    env: COMPILER_VERSION=-3.7 SCRIPT="bash ./tools/package.sh $PWD $PWD/dist travis ON Debug Disable"
addons:
  apt:
    sources:
    - george-edison55-precise-backports
    - sourceline: 'ppa:teward/swig3.0'
    packages:
    - libicu-dev
    - swig3.0
    - doxygen
    - graphviz
    - mono-complete
    - libgtest-dev
    - python-numpy
cache:
  directories:
    - $HOME/NUnit-2.6.4
    - $HOME/cmake

install:
- source tools/prereqs/travis-${TRAVIS_OS_NAME}-install.sh
- if [ ! -z $DOCKER_IMAGE ]; then docker pull $DOCKER_IMAGE ; fi
- ls $HOME/NUnit-2.6.4

before_script:
- export CC="${COMPILER_HOME}${CC}${COMPILER_VERSION}"
- export CXX="${COMPILER_HOME}${CXX}${COMPILER_VERSION}"
- cmake -version
- which $CC
- which $CXX

script:
- $SCRIPT

#white list broke the tag push deployment

branches:
  only:
  - master
  - /v\d\.\d\.\d/

notifications:
  email: false

before_deploy:
  - export PATH=/opt/pyenv:/opt/pyenv/shims:$PATH
  - if [ "$TRAVIS_OS_NAME != "osx ] ; then sudo env "PATH=$PATH" pyenv install 3.5.4 -s  || true; fi
  - if [ "$TRAVIS_OS_NAME != "osx ] ; then sudo env "PATH=$PATH" pyenv global 3.5.4; fi
  - if [ "$TRAVIS_OS_NAME != "osx ] ; then sudo env "PATH=$PATH" pip install twine; fi
  - if [ "$TRAVIS_TAG" != "" ] && [ "$DEPLOY_BUILD" == "true" ] ; then twine upload --skip-existing $PWD/dist/*.whl; fi

deploy:
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: "JSseSilCDLN+26l5Jc3RICog4p0lXjEaQsRUraabJzuBu5YcgIS+fG3stQdaUTJechA/pnGy8UVMqLY1Yd1ZTxSxt/GFjyArVUSXO+eJzBGHs/bfikMw7BILrB/FKNi0+c1A5fuUou/7P7eIIHF/pbfPV+G3y3EaH/RerwW+x7LIKM1BCXZkZEMEg2CSnqguP1TPV/bv7+fsmOsI2LWReRuczq8f7MS1lLg7ABbKOANZIZBlf4KmP3SkIuc6euTNA7bzapVQAuydgwBxW7IExBNguCa5FCRIOrT68VWYCCvH9JPonL7B2qkTcmntkpGtBNiuNpcG3jFi91xbz6FMDsAsiO7sTvtbJ/LCVpr120kv5gPeMSbH/yMYIBqoSoVneY0fNDd5vwitmLXnWlxeMAlNTaVJIVsYk5eD5Zqe4lE0JHEAFhNhRYDZF6XKnpiedAd8Xe8rJoMG4Fkl92fdPmb277+ta4xoVHWsl7KI6wP2s+49KzqaOu1LH+DS784t2xjS9noGAxR8SBmaqQs3tvs7CkZZi0sl81bPbj3aeoewD/nSHlK87H4VpARtfStB7PJMMNsPbI4tQWkdP0vkyKVmacpYxBjJ7Ick/jv3iaRK1tUdUfB4VzhJnvTadBjMavaI/KrxZp8HZMX5VImZMSQClC9QccOckaLcAt/HyS8="
    file_glob: true
    file: $PWD/dist/*.*
    on:
      repo: Illumina/interop
      branch: master
      tags: true
      condition:
        - "$DEPLOY_BUILD == true"
  - provider: pages
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    local_dir: $PWD/dist/html
    on:
      repo: Illumina/interop
      branch: master
      tags: true
      condition:
      - "$DEPLOY_DOCS == true"

