language: cpp
matrix:
  include:
    - compiler: clang
      os: linux
      env: INTEROP_C89=ON
    - compiler: gcc
      os: linux
      env: INTEROP_C89=ON
    - compiler: gcc
      env: INTEROP_CXX=g++-5 INTEROP_CC=gcc-5 INTEROP_C89=OFF
      os: linux
    - compiler: gcc
      env: INTEROP_CXX=g++-4.2 INTEROP_CC=gcc-4.2 INTEROP_C89=ON
      os: linux
    - compiler: clang
      os: osx
      env: INTEROP_C89=ON

before_install:
  - date -u
  - uname -a

addons:
  apt:
    sources:
      - george-edison55-precise-backports
    packages:
      - cmake
      - cmake-data

install:
  - if test "$TRAVIS_OS_NAME" = "linux"; then source tools/travis-linux-install.sh; fi
  - if test "$TRAVIS_OS_NAME" = "osx"; then source tools/travis-osx-install.sh; fi
  - ls -la $(which $CC)
  - ls -la $(which $CXX)
  - $CC --version
  - $CXX --version

script:
  - echo 'Configuring...' && echo -en 'travis_fold:start:script.1\\r'
  - mkdir -p build && cd build && cmake ../ -DNUNIT_ROOT=$PWD/../NUnit-2.6.4 -DENABLE_BACKWARDS_COMPATIBILITY=$INTEROP_C89 -DCMAKE_CXX_COMPILER=$(which $INTEROP_CXX) -DCMAKE_CC_COMPILER=$(which $INTEROP_CC)
  - echo -en 'travis_fold:end:script.1\\r'
  - cmake --build .
  - echo 'Installing...' && echo -en 'travis_fold:start:script.2\\r'
  - sudo make install
  - echo -en 'travis_fold:end:script.2\\r'
  - cmake --build . --target check
  - echo 'Cleaning...' && echo -en 'travis_fold:start:script.3\\r'
  - make clean
  - echo -en 'travis_fold:end:script.3\\r'

branches:
  only:
    - master

notifications:
  email: false