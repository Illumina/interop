# Configuration for AppVeyor Continuous Integration Service
#
# Build status: https://ci.appveyor.com/project/ezralanglois/interop
#

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

on_finish:
  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
configuration:
  - Debug
  - Release

environment:
  matrix:
#    - generator: "Visual Studio 14 2015 Win64"
#    - generator: "Visual Studio 14 2015"
#    - generator: "Visual Studio 12 2013 Win64"
#    - generator: "Visual Studio 12 2013"

# Cannot compile GTest with MinGW
    - generator: "MinGW Makefiles"
      tool_path: C:\MinGW\bin
      tool_type: mingw
      tool_arch: x64
#
#
before_build: # move to mingw
  - set PATH=%PATH:C:\Program Files\Git\usr\bin;=%
  - set PATH=%tool_path%:%PATH%

install:
  - cmd: date /T & time /T
  - cmd: choco install swig --version 3.0.5 -y > NUL
  - appveyor DownloadFile http://googletest.googlecode.com/files/gtest-1.7.0.zip -FileName gtest-1.7.0.zip
  - cmd: 7z x gtest-1.7.0.zip > NUL
  - cmd: cd gtest-1.7.0
  - cmd: md build_x86
  - cmd: cd build_x86
  - cmd: ps: echo "$env:tool_path"
  - cmd: set GTEST_PREFIX=%cd%
  - cmd: set PATH=%PATH;C:\Program Files\Git\usr\bin;=%
  - cmd: set PATH=C:\MinGW\bin;%PATH%
  - cmd: cmake ../ -G "MinGW Makefiles" -DGTEST_USE_OWN_TR1_TUPLE=0 -DCMAKE_BUILD_TYPE=Release -DCMAKE_ARCHIVE_OUTPUT_DIRECTORY=%GTEST_PREFIX%/lib64 -DCMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG=%GTEST_PREFIX%/lib64 -DCMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE=%GTEST_PREFIX%/lib64 -DCMAKE_LIBRARY_OUTPUT_DIRECTORY=%GTEST_PREFIX%/lib64 -DCMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG=%GTEST_PREFIX%/lib64 -DCMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE=%GTEST_PREFIX%/lib64
  - cmd: cmake --build . --config Release
  - cmd: cd ..
  - cmd: cd ..

build_script:
  - cmake --version
  - cmake ../ -G "%GENERATOR%" -H. -Bbuild -DCMAKE_BUILD_TYPE="%configuration%" -DGTEST_ROOT=%GTEST_PREFIX%
  - cmake --build build --config "%configuration%"

test_script:
  - cmake --build build --config "%configuration%" --target check

branches:
  only:
  - master
  - ipa-3627-appveyor