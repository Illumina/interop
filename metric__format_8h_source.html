<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <!-- For Mobile Devices -->
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <!-- Loading Lato Font -->
 <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
 <!-- Loading Font Awesome -->
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
 <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
 <meta name="generator" content="Doxygen 1.8.10"/>
 <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-88338608-1', 'auto');
  ga('send', 'pageview');
</script>
 <title>/io/interop/io/format/metric_format.h Source File</title>
 <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
 <script type="text/javascript" src="dynsections.js"></script>
 <link href="doxygen.css" rel="stylesheet" type="text/css" />
 <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
 <link rel="stylesheet" href="bootstrap3/css/bootstrap.min.css">
 <link href="bootstrap3/css/sticky-footer-navbar.css" rel="stylesheet">
 <script src="bootstrap3/js/bootstrap.min.js"></script>
 <script type="text/javascript" src="doxy-boot.js"></script>
</head>
<body screen_capture_injected="true">
<nav class="navbar navbar-inverse" role="navigation">
 <div class="container">
  <div class="navbar-header">
   <a class="navbar-brand" href="https://www.illumina.com/"><img style='margin-top: -8px !important;height: 40px !important;' src='ILLUMINA_LOGO_RGB_new_200_45.png' /></a>
   <a class="navbar-brand">InterOp <span style="font-size: 10pt">v1.2.3</span>  </a>
  </div>
  <div class="collapse navbar-collapse">
   <!-- Left -->
   <ul class="nav navbar-nav adjust-right">
    <li><a href="https://github.com/Illumina/interop">Code</a></li>
    <li><a href="https://github.com/Illumina/interop/issues">Issues</a></li>
    <li><a href="https://github.com/Illumina/interop/releases/latest">Download</a></li>
   </ul>
  </div><!--/.nav-collapse -->
 </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
 <div class="content" id="content">
  <div class="container">
   <div class="row">
    <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
     <div style="margin-bottom: 15px;">
      <!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="pages.html"><span>Index</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc161955dc3a3d2485839eba21420d01.html">io</a></li><li class="navelem"><a class="el" href="dir_44f80f2f1dec9ef0840266fc0f4baffa.html">interop</a></li><li class="navelem"><a class="el" href="dir_8824d761a77e9b744b7486fdd0f5ddee.html">io</a></li><li class="navelem"><a class="el" href="dir_b0755fd43f308dffec47371717ee5e8a.html">format</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">metric_format.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="metric__format_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#pragma warning(disable:4702) // MSVC warns that there is unreachable code</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="exception_8h.html">interop/util/exception.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="abstract__metric__format_8h.html">interop/io/format/abstract_metric_format.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="generic__layout_8h.html">interop/io/format/generic_layout.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="stream__util_8h.html">interop/io/format/stream_util.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceillumina.html">illumina</a> { <span class="keyword">namespace </span>interop { <span class="keyword">namespace </span>io</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">template</span>&lt;<span class="keyword">class</span> Metric, <span class="keyword">class</span> Layout&gt;</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html">   31</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html">metric_format</a> : <span class="keyword">public</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1abstract__metric__format.html">abstract_metric_format</a>&lt;Metric&gt;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> Metric::id_t <a class="code" href="structillumina_1_1interop_1_1io_1_1abstract__metric__format.html#a95c6107ae65a4b4200a060b8a60779c4">id_t</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keyword">typedef</span> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">model::metric_base::metric_set&lt;Metric&gt;</a> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">metric_set_t</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a661897958360048922c1e21cae9e9208">metric_set_t::offset_map_t</a> offset_map_t;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a31575680c664e011dceb1a741c09433d">   39</a></span>&#160;        <span class="keyword">typedef</span> Metric <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a31575680c664e011dceb1a741c09433d">metric_t</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a25f36b9805ea5550b9ed747d4d23f3df">   41</a></span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> Metric::header_type <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a25f36b9805ea5550b9ed747d4d23f3df">header_t</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a347b2329e49627f77a7f665010ba17aa">   43</a></span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> Layout::metric_id_t <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a347b2329e49627f77a7f665010ba17aa">metric_id_t</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a6b3651c287e058f9f1f517666cdb452b">   45</a></span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> Layout::record_size_t <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a6b3651c287e058f9f1f517666cdb452b">record_size_t</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a5532cb752ace18d41915e65dd531c97d">   52</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a5532cb752ace18d41915e65dd531c97d">write_metric_header</a>(std::ostream &amp;out, <span class="keyword">const</span> header_t &amp;header)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            const ::uint8_t <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#aaa030865457238e5711e804d6f1741d3">version</a> = <span class="keyword">static_cast&lt;</span> ::uint8_t <span class="keyword">&gt;</span>(Layout::VERSION);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <a class="code" href="namespaceillumina_1_1interop_1_1io.html#a41e1142e5fce4f824c441c91ea663e2b">write_binary</a>(out, version);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            Layout::map_stream_record_size(out, Layout::compute_size(header));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            Layout::map_stream_for_header(out, header);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a7e4d3c05c9c020283a410e5367a1a3d1">   66</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a7e4d3c05c9c020283a410e5367a1a3d1">write_metric</a>(std::ostream &amp;out, <span class="keyword">const</span> metric_t &amp;metric, <span class="keyword">const</span> header_t &amp;header)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            metric_id_t metric_id;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            metric_id.set(metric);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <a class="code" href="namespaceillumina_1_1interop_1_1io.html#a41e1142e5fce4f824c441c91ea663e2b">write_binary</a>(out, metric_id);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            Layout::map_stream(out, metric, header, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        }</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a75c31a4a225cf23cd5c633cf40ebdc23">   79</a></span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a75c31a4a225cf23cd5c633cf40ebdc23">read_header</a>(std::istream&amp; in, <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">model::metric_base::metric_set&lt;Metric&gt;</a>&amp; metric_set)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">size_t</span> version_byte_size = 1;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="keyword">const</span> std::streampos beg = in.tellg();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ac952aa7cea8fd24a92cb9a4ff4a505c0">read_header_impl</a>(in, metric_set);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(in.tellg()-beg)+version_byte_size;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a3ecbc80b31116000a3a910e9abcc68e3">   93</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a3ecbc80b31116000a3a910e9abcc68e3">read_metrics</a>(std::istream&amp; in, metric_set_t&amp; metric_set, <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="namespaceillumina_1_1interop_1_1io.html#af73c24a41560f0fb1c31fbbc422c9360">file_size</a>)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keyword">const</span> std::streamsize <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">record_size</a> = <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ac952aa7cea8fd24a92cb9a4ff4a505c0">read_header_impl</a>(in, metric_set);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            offset_map_t&amp; metric_offset_map = metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a01207babab3cbeefea845599562e8b2f">offset_map</a>();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            metric_t metric(metric_set);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">if</span>(file_size &gt; 0 &amp;&amp; !Layout::MULTI_RECORD)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">size_t</span> record_count = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>((file_size-<a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a65a1ffd3bf8e0948e009fbc8301f8d3b">header_size</a>(metric_set))/record_size);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a0d5fe46a64f11c5a479aaeb8a125f370">resize</a>(metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>()+record_count);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                std::vector&lt;char&gt; buffer(static_cast&lt;size_t&gt;(record_size));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <a class="code" href="assert_8h.html#ad8e972bc7b148e20887839a11697e78e">INTEROP_ASSERT</a>(!buffer.empty());</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">while</span> (in)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <span class="keywordtype">char</span> *in_ptr = &amp;buffer.front();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    in.read(in_ptr, record_size);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    <span class="keyword">const</span> std::streamsize count = in.gcount();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        <span class="keywordflow">if</span> (!test_stream(in, metric_offset_map, count, record_size)) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        read_record(in_ptr, metric_set, metric_offset_map, metric, record_size);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1incomplete__file__exception.html">incomplete_file_exception</a>&amp; ex)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#afa6a65520b13e6a1e03f6800e111e9d9">trim</a>(metric_offset_map.size());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        <span class="keywordflow">throw</span> ex;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="keywordflow">while</span> (in)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    read_record(in, metric_set, metric_offset_map, metric, record_size);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#afa6a65520b13e6a1e03f6800e111e9d9">trim</a>(metric_offset_map.size());</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        }</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ac952aa7cea8fd24a92cb9a4ff4a505c0">  136</a></span>&#160;        std::streamsize <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ac952aa7cea8fd24a92cb9a4ff4a505c0">read_header_impl</a>(std::istream &amp;in, header_t &amp;header)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="comment">// TODO: optimize header reading with block read</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">if</span> (in.fail())</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(<a class="code" href="structillumina_1_1interop_1_1io_1_1incomplete__file__exception.html">incomplete_file_exception</a>, <span class="stringliteral">&quot;Insufficient header data read from the file&quot;</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; for &quot;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        &lt;&lt; Metric::prefix() &lt;&lt;  <span class="stringliteral">&quot; &quot;</span>  &lt;&lt; Metric::suffix()  &lt;&lt;  <span class="stringliteral">&quot; v&quot;</span>  &lt;&lt; Layout::VERSION);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="comment">//if we&#39;re not actually reading the record size from the stream</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="comment">// (the stream position is the same before and after),</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="comment">// then don&#39;t compare the layout size against the record size</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            const ::int64_t stream_position_pre_record_check = in.tellg();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keyword">const</span> std::streamsize <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">record_size</a> = Layout::map_stream_record_size(in,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                                               static_cast&lt;record_size_t&gt;(0));</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">if</span>(in.fail())</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(<a class="code" href="structillumina_1_1interop_1_1io_1_1incomplete__file__exception.html">incomplete_file_exception</a>, <span class="stringliteral">&quot;Insufficient header data read from the file&quot;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; for &quot;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        &lt;&lt; Metric::prefix() &lt;&lt;  <span class="stringliteral">&quot; &quot;</span>  &lt;&lt; Metric::suffix()  &lt;&lt;  <span class="stringliteral">&quot; v&quot;</span>  &lt;&lt; Layout::VERSION);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">if</span>(record_size==0)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(<a class="code" href="structillumina_1_1interop_1_1io_1_1bad__format__exception.html">bad_format_exception</a>, <span class="stringliteral">&quot;Record size cannot be 0&quot;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            const ::int64_t stream_position_post_record_check = in.tellg();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            Layout::map_stream_for_header(in, header);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span> (in.fail())</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(<a class="code" href="structillumina_1_1interop_1_1io_1_1incomplete__file__exception.html">incomplete_file_exception</a>, <span class="stringliteral">&quot;Insufficient extended header data read from the file&quot;</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keyword">const</span> std::streamsize layout_size = Layout::compute_size(header);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">if</span> (stream_position_pre_record_check != stream_position_post_record_check &amp;&amp; record_size != layout_size)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(<a class="code" href="structillumina_1_1interop_1_1io_1_1bad__format__exception.html">bad_format_exception</a>, <span class="stringliteral">&quot;Record size does not match layout size, record size: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                           record_size &lt;&lt; <span class="stringliteral">&quot; != layout size: &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                           layout_size &lt;&lt; <span class="stringliteral">&quot; for &quot;</span>  &lt;&lt;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                           Metric::prefix() &lt;&lt;  <span class="stringliteral">&quot; &quot;</span>  &lt;&lt; Metric::suffix()  &lt;&lt;  <span class="stringliteral">&quot; v&quot;</span>  &lt;&lt;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                           Layout::VERSION);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">return</span> layout_size;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">  179</a></span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">buffer_size</a>(<span class="keyword">const</span> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">model::metric_base::metric_set&lt;Metric&gt;</a>&amp; metric_set)<span class="keyword"> const</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">buffer_size</a>(metric_set, <a class="code" href="structillumina_1_1interop_1_1int__constant__type.html">int_constant_type&lt;Layout::MULTI_RECORD&gt;::null</a>());</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">  189</a></span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">record_size</a>(<span class="keyword">const</span> header_t &amp;header)<span class="keyword"> const</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Layout::compute_size(header));</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a65a1ffd3bf8e0948e009fbc8301f8d3b">  199</a></span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a65a1ffd3bf8e0948e009fbc8301f8d3b">header_size</a>(<span class="keyword">const</span> header_t &amp;header)<span class="keyword"> const</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(Layout::compute_header_size(header));</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#aaa030865457238e5711e804d6f1741d3">  208</a></span>&#160;        ::int16_t <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#aaa030865457238e5711e804d6f1741d3">version</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span> ::int16_t <span class="keyword">&gt;</span>(Layout::VERSION);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a065d1c20af8def80aa0848b628f3492e">  216</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a065d1c20af8def80aa0848b628f3492e">is_multi_record</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">return</span> Layout::MULTI_RECORD &gt; 0;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        }</div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ae991f054d36e419e750f4cc6545a7361">  224</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#ae991f054d36e419e750f4cc6545a7361">is_deprecated</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">return</span> Layout::IS_DEPRECATED &gt; 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structillumina_1_1interop_1_1constant__type.html">int_constant_type&lt;0&gt;::pointer_t</a> is_single_record_t;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structillumina_1_1interop_1_1constant__type.html">int_constant_type&lt;1&gt;::pointer_t</a> is_multi_record_t;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">buffer_size</a>(<span class="keyword">const</span> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">model::metric_base::metric_set&lt;Metric&gt;</a>&amp; metric_set, is_single_record_t)<span class="keyword">const</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a65a1ffd3bf8e0948e009fbc8301f8d3b">header_size</a>(metric_set) + <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">record_size</a>(metric_set)*metric_set.<a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>();</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">buffer_size</a>(<span class="keyword">const</span> <a class="code" href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">model::metric_base::metric_set&lt;Metric&gt;</a>&amp; metric_set, is_multi_record_t)<span class="keyword">const</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__file__io.html#ga312d9e26d4af091fddae2752db5b705b">Layout::compute_buffer_size</a>(metric_set);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> test_stream(std::istream&amp; in,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                         <span class="keyword">const</span> offset_map_t&amp; metric_offset_map,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                         <span class="keyword">const</span> std::streamsize count,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                         <span class="keyword">const</span> std::streamsize <a class="code" href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">record_size</a>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">if</span> (in.fail())</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keywordflow">if</span> (count == 0 &amp;&amp; !metric_offset_map.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(incomplete_file_exception, <span class="stringliteral">&quot;Insufficient data read from the file, got: &quot;</span> &lt;&lt; count</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                                         &lt;&lt; <span class="stringliteral">&quot; != expected: &quot;</span> &lt;&lt; record_size &lt;&lt; <span class="stringliteral">&quot; for &quot;</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                         &lt;&lt; Metric::prefix() &lt;&lt;  <span class="stringliteral">&quot; &quot;</span>  &lt;&lt; Metric::suffix()  &lt;&lt;  <span class="stringliteral">&quot; v&quot;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                         &lt;&lt; Layout::VERSION);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> test_stream(<span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keyword">const</span> offset_map_t&amp;, <span class="keyword">const</span> std::streamsize, <span class="keyword">const</span> std::streamsize)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        {<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> InputStream&gt;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">void</span> read_record(InputStream&amp; in,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                model::metric_base::metric_set&lt;Metric&gt;&amp; metric_set,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                offset_map_t&amp; metric_offset_map,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                metric_t&amp; metric,</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                <span class="keyword">const</span> std::streamsize record_size)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            metric_id_t id;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keyword">const</span> std::streamsize read_byte_count = <a class="code" href="namespaceillumina_1_1interop_1_1io.html#a5a11b282e3fb6c3ba78da0d0d6c70ccd">read_binary_with_count</a> (in, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span>(!test_stream(in, metric_offset_map, read_byte_count, record_size)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            std::streamsize count=read_byte_count;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">if</span> (Layout::is_valid(<span class="keywordtype">id</span>))</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="comment">// TODO: Refactor tile metrics to move record type into layout id, then we can remove skip_metric,</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="comment">// simplifiy all this logic</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                metric.set_base(<span class="keywordtype">id</span>);<span class="comment">// TODO replace with static call</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">if</span> (metric_offset_map.find(metric.id()) == metric_offset_map.end())</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset = metric_offset_map.size();</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    <span class="keywordflow">if</span>(offset&gt;= metric_set.size()) metric_set.resize(offset+1);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    metric_set[offset].set_base(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    count += Layout::map_stream(in, metric_set[offset], metric_set, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    <span class="keywordflow">if</span>(!test_stream(in, metric_offset_map, count, record_size)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="keywordflow">if</span>(Layout::skip_metric(metric_set[offset]))<span class="comment">//Avoid adding control lanes in tile metrics</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                        metric_set.resize(offset);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <span class="keywordflow">else</span> metric_offset_map[metric.id()] = offset;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset = metric_offset_map[metric.id()];</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                    count += Layout::map_stream(in, metric_set[offset], metric_set, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <a class="code" href="assert_8h.html#ad8e972bc7b148e20887839a11697e78e">INTEROP_ASSERT</a>(metric_set[offset].<span class="keywordtype">id</span>()&gt;0);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                count += Layout::map_stream(in, metric, metric_set, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="comment">//TODO: replace with skip function, simplify code, required for index metrics</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">if</span>(!test_stream(in, metric_offset_map, count, record_size)) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">if</span> (count != record_size)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <a class="code" href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a>(bad_format_exception, <span class="stringliteral">&quot;Record does not match expected size! for &quot;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                                     &lt;&lt; Metric::prefix() &lt;&lt;  <span class="stringliteral">&quot; &quot;</span>  &lt;&lt; Metric::suffix()  &lt;&lt;  <span class="stringliteral">&quot; v&quot;</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                                     &lt;&lt; Layout::VERSION &lt;&lt; <span class="stringliteral">&quot; count=&quot;</span> &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; != &quot;</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                                                     &lt;&lt; <span class="stringliteral">&quot; record_size: &quot;</span> &lt;&lt; record_size</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                                                     &lt;&lt; <span class="stringliteral">&quot; n= &quot;</span> &lt;&lt; metric_offset_map.size());</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    };</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}}}</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_aaa030865457238e5711e804d6f1741d3"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#aaa030865457238e5711e804d6f1741d3">illumina::interop::io::metric_format::version</a></div><div class="ttdeci">::int16_t version() const </div><div class="ttdef"><b>Definition:</b> metric_format.h:208</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html">illumina::interop::model::metric_base::metric_set</a></div><div class="ttdef"><b>Definition:</b> metric_set.h:40</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1abstract__metric__format_html_a95c6107ae65a4b4200a060b8a60779c4"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1abstract__metric__format.html#a95c6107ae65a4b4200a060b8a60779c4">illumina::interop::io::abstract_metric_format::id_t</a></div><div class="ttdeci">metric_t::id_t id_t</div><div class="ttdef"><b>Definition:</b> abstract_metric_format.h:31</div></div>
<div class="ttc" id="namespaceillumina_html"><div class="ttname"><a href="namespaceillumina.html">illumina</a></div><div class="ttdef"><b>Definition:</b> enum_description.h:15</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a25f36b9805ea5550b9ed747d4d23f3df"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a25f36b9805ea5550b9ed747d4d23f3df">illumina::interop::io::metric_format::header_t</a></div><div class="ttdeci">Metric::header_type header_t</div><div class="ttdef"><b>Definition:</b> metric_format.h:41</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1abstract__metric__format_html"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1abstract__metric__format.html">illumina::interop::io::abstract_metric_format</a></div><div class="ttdef"><b>Definition:</b> abstract_metric_format.h:24</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html_afa6a65520b13e6a1e03f6800e111e9d9"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#afa6a65520b13e6a1e03f6800e111e9d9">illumina::interop::model::metric_base::metric_set::trim</a></div><div class="ttdeci">void trim(const size_t n)</div><div class="ttdef"><b>Definition:</b> metric_set.h:258</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a828d03d393d5e8c2b93c6f5317b1b94e"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a828d03d393d5e8c2b93c6f5317b1b94e">illumina::interop::io::metric_format::buffer_size</a></div><div class="ttdeci">size_t buffer_size(const model::metric_base::metric_set&lt; Metric &gt; &amp;metric_set) const </div><div class="ttdef"><b>Definition:</b> metric_format.h:179</div></div>
<div class="ttc" id="exception_8h_html_a3d604eac5b4c9ee8b755c81e9feec93f"><div class="ttname"><a href="exception_8h.html#a3d604eac5b4c9ee8b755c81e9feec93f">INTEROP_THROW</a></div><div class="ttdeci">#define INTEROP_THROW(EXCEPTION, MESSAGE)</div><div class="ttdef"><b>Definition:</b> exception.h:18</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html_aac782da1f912bceb5d8ad00c8dc892ac"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#aac782da1f912bceb5d8ad00c8dc892ac">illumina::interop::model::metric_base::metric_set::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> metric_set.h:519</div></div>
<div class="ttc" id="generic__layout_8h_html"><div class="ttname"><a href="generic__layout_8h.html">generic_layout.h</a></div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_ac952aa7cea8fd24a92cb9a4ff4a505c0"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#ac952aa7cea8fd24a92cb9a4ff4a505c0">illumina::interop::io::metric_format::read_header_impl</a></div><div class="ttdeci">std::streamsize read_header_impl(std::istream &amp;in, header_t &amp;header)</div><div class="ttdef"><b>Definition:</b> metric_format.h:136</div></div>
<div class="ttc" id="exception_8h_html"><div class="ttname"><a href="exception_8h.html">exception.h</a></div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html">illumina::interop::io::metric_format</a></div><div class="ttdef"><b>Definition:</b> metric_format.h:31</div></div>
<div class="ttc" id="assert_8h_html_ad8e972bc7b148e20887839a11697e78e"><div class="ttname"><a href="assert_8h.html#ad8e972bc7b148e20887839a11697e78e">INTEROP_ASSERT</a></div><div class="ttdeci">#define INTEROP_ASSERT(TST)</div><div class="ttdef"><b>Definition:</b> assert.h:21</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html_a661897958360048922c1e21cae9e9208"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a661897958360048922c1e21cae9e9208">illumina::interop::model::metric_base::metric_set::offset_map_t</a></div><div class="ttdeci">std::map&lt; id_t, size_t &gt; offset_map_t</div><div class="ttdef"><b>Definition:</b> metric_set.h:70</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1int__constant__type_html"><div class="ttname"><a href="structillumina_1_1interop_1_1int__constant__type.html">illumina::interop::int_constant_type</a></div><div class="ttdef"><b>Definition:</b> type_traits.h:161</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1constant__type_html"><div class="ttname"><a href="structillumina_1_1interop_1_1constant__type.html">illumina::interop::constant_type&lt; int, v &gt;</a></div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a6b3651c287e058f9f1f517666cdb452b"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a6b3651c287e058f9f1f517666cdb452b">illumina::interop::io::metric_format::record_size_t</a></div><div class="ttdeci">Layout::record_size_t record_size_t</div><div class="ttdef"><b>Definition:</b> metric_format.h:45</div></div>
<div class="ttc" id="namespaceillumina_1_1interop_1_1io_html_a41e1142e5fce4f824c441c91ea663e2b"><div class="ttname"><a href="namespaceillumina_1_1interop_1_1io.html#a41e1142e5fce4f824c441c91ea663e2b">illumina::interop::io::write_binary</a></div><div class="ttdeci">void write_binary(std::ostream &amp;out, const T *buffer, const size_t n)</div><div class="ttdef"><b>Definition:</b> stream_util.h:158</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a347b2329e49627f77a7f665010ba17aa"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a347b2329e49627f77a7f665010ba17aa">illumina::interop::io::metric_format::metric_id_t</a></div><div class="ttdeci">Layout::metric_id_t metric_id_t</div><div class="ttdef"><b>Definition:</b> metric_format.h:43</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a3ecbc80b31116000a3a910e9abcc68e3"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a3ecbc80b31116000a3a910e9abcc68e3">illumina::interop::io::metric_format::read_metrics</a></div><div class="ttdeci">void read_metrics(std::istream &amp;in, metric_set_t &amp;metric_set, const size_t file_size)</div><div class="ttdef"><b>Definition:</b> metric_format.h:93</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a65a1ffd3bf8e0948e009fbc8301f8d3b"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a65a1ffd3bf8e0948e009fbc8301f8d3b">illumina::interop::io::metric_format::header_size</a></div><div class="ttdeci">size_t header_size(const header_t &amp;header) const </div><div class="ttdef"><b>Definition:</b> metric_format.h:199</div></div>
<div class="ttc" id="stream__util_8h_html"><div class="ttname"><a href="stream__util_8h.html">stream_util.h</a></div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a31575680c664e011dceb1a741c09433d"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a31575680c664e011dceb1a741c09433d">illumina::interop::io::metric_format::metric_t</a></div><div class="ttdeci">Metric metric_t</div><div class="ttdef"><b>Definition:</b> metric_format.h:39</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a7e4d3c05c9c020283a410e5367a1a3d1"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a7e4d3c05c9c020283a410e5367a1a3d1">illumina::interop::io::metric_format::write_metric</a></div><div class="ttdeci">void write_metric(std::ostream &amp;out, const metric_t &amp;metric, const header_t &amp;header)</div><div class="ttdef"><b>Definition:</b> metric_format.h:66</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a5532cb752ace18d41915e65dd531c97d"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a5532cb752ace18d41915e65dd531c97d">illumina::interop::io::metric_format::write_metric_header</a></div><div class="ttdeci">void write_metric_header(std::ostream &amp;out, const header_t &amp;header)</div><div class="ttdef"><b>Definition:</b> metric_format.h:52</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a9ba62e2c9596a25620811c27d9008bc3"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a9ba62e2c9596a25620811c27d9008bc3">illumina::interop::io::metric_format::record_size</a></div><div class="ttdeci">size_t record_size(const header_t &amp;header) const </div><div class="ttdef"><b>Definition:</b> metric_format.h:189</div></div>
<div class="ttc" id="namespaceillumina_1_1interop_1_1io_html_a5a11b282e3fb6c3ba78da0d0d6c70ccd"><div class="ttname"><a href="namespaceillumina_1_1interop_1_1io.html#a5a11b282e3fb6c3ba78da0d0d6c70ccd">illumina::interop::io::read_binary_with_count</a></div><div class="ttdeci">std::streamsize read_binary_with_count(std::istream &amp;in, T &amp;buffer)</div><div class="ttdef"><b>Definition:</b> stream_util.h:76</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html_a01207babab3cbeefea845599562e8b2f"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a01207babab3cbeefea845599562e8b2f">illumina::interop::model::metric_base::metric_set::offset_map</a></div><div class="ttdeci">offset_map_t &amp; offset_map()</div><div class="ttdef"><b>Definition:</b> metric_set.h:580</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1bad__format__exception_html"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1bad__format__exception.html">illumina::interop::io::bad_format_exception</a></div><div class="ttdef"><b>Definition:</b> stream_exceptions.h:59</div></div>
<div class="ttc" id="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set_html_a0d5fe46a64f11c5a479aaeb8a125f370"><div class="ttname"><a href="classillumina_1_1interop_1_1model_1_1metric__base_1_1metric__set.html#a0d5fe46a64f11c5a479aaeb8a125f370">illumina::interop::model::metric_base::metric_set::resize</a></div><div class="ttdeci">void resize(const size_t n)</div><div class="ttdef"><b>Definition:</b> metric_set.h:242</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1incomplete__file__exception_html"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1incomplete__file__exception.html">illumina::interop::io::incomplete_file_exception</a></div><div class="ttdef"><b>Definition:</b> stream_exceptions.h:73</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a065d1c20af8def80aa0848b628f3492e"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a065d1c20af8def80aa0848b628f3492e">illumina::interop::io::metric_format::is_multi_record</a></div><div class="ttdeci">bool is_multi_record() const </div><div class="ttdef"><b>Definition:</b> metric_format.h:216</div></div>
<div class="ttc" id="abstract__metric__format_8h_html"><div class="ttname"><a href="abstract__metric__format_8h.html">abstract_metric_format.h</a></div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_a75c31a4a225cf23cd5c633cf40ebdc23"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#a75c31a4a225cf23cd5c633cf40ebdc23">illumina::interop::io::metric_format::read_header</a></div><div class="ttdeci">size_t read_header(std::istream &amp;in, model::metric_base::metric_set&lt; Metric &gt; &amp;metric_set)</div><div class="ttdef"><b>Definition:</b> metric_format.h:79</div></div>
<div class="ttc" id="group__file__io_html_ga312d9e26d4af091fddae2752db5b705b"><div class="ttname"><a href="group__file__io.html#ga312d9e26d4af091fddae2752db5b705b">illumina::interop::io::compute_buffer_size</a></div><div class="ttdeci">size_t compute_buffer_size(const MetricSet &amp;metrics) INTEROP_THROW_SPEC((io</div><div class="ttdef"><b>Definition:</b> metric_file_stream.h:32</div></div>
<div class="ttc" id="namespaceillumina_1_1interop_1_1io_html_af73c24a41560f0fb1c31fbbc422c9360"><div class="ttname"><a href="namespaceillumina_1_1interop_1_1io.html#af73c24a41560f0fb1c31fbbc422c9360">illumina::interop::io::file_size</a></div><div class="ttdeci">::int64_t file_size(const std::string &amp;path)</div><div class="ttdef"><b>Definition:</b> filesystem.cpp:156</div></div>
<div class="ttc" id="structillumina_1_1interop_1_1io_1_1metric__format_html_ae991f054d36e419e750f4cc6545a7361"><div class="ttname"><a href="structillumina_1_1interop_1_1io_1_1metric__format.html#ae991f054d36e419e750f4cc6545a7361">illumina::interop::io::metric_format::is_deprecated</a></div><div class="ttdeci">bool is_deprecated() const </div><div class="ttdef"><b>Definition:</b> metric_format.h:224</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/>
</body>
</html>
